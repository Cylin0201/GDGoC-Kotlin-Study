# 14장. 코루틴
## 14.1 동시성과 병려렁
**동시성**은 여러 작업을 동시에 실행하는 것을 말한다. 하지만 모든 작업을 물리적으로 함께 실행할 필요가 없기에, 코드의 여러 부분을 돌아가면서 실행하는 것도 동시성 시스템이다.

**병렬성**은 여러 작업을 여러 CPU 코어에서 물리적으로 동시에 시행하는 것을 말한다. 

## 14.2 일시 중단 함수와 코루틴
코루틴은 비동기적으로 실행되는 넌블로킹 동시성 코드를 우아하게 작성할 수 있게 한다. 또한 스레드와 비교해서 훨씬 더 가볍게 작동한다.

## 14.3 스레드 vs 코루틴
코틀린은 스레드에 대한 대안으로 코루틴이라는 추상화를 도입한다. 코루틴은 일시 중단 가능한 계산을 나타낸다.
아래와 같은 장점이 있다.
- 코루틴은 초경량 추상화이기에, 일반적인 노트북에서도 매우 많은 코루틴을 쉽게 실행할 수 있다. 생성하고 관리하는 비용이 저렴하다.
- 코루틴은 시스템 자원을 블록키지 않고 실행을  일시 중단할 수 있으며, 나중에 중단된 지점에서 실행을 재개할 수 있다.
- 구조화된 동시성이라는 개념을 통해 동시성 작업의 구조와 계층을 확립하며, 취소 및 오류 처리를 위한 메커니즘을 제공한다.

내부적으로 코루틴은 하나 이상의 JVM 스레드데엇 실행된다. 이를 통해 작성한 코드도 여전히 기본 스레드 모델이 제공하는 병렬성을 활용할 수 있지만, OS가 부과하는 스레드의 한계에 얽매이지 않는다는 것을 의미한다.

## 14.4 일시 중단함수
코루틴이 다른 동시성 접근 방식과 다른 핵심 속성으로 상당수의 경우 코드 형태를 크게 변경할 필요가 없다는 점이다.

```kotlin
//14.2 일시 중단 함수를 사용해 같은 로직 수행하기
suspend fun login(credentails: Credentails): UserID
suspend fun loadUserData(userId: UserID): UserData
fun showData(data: UserData)

suspend fun showUserInfo(credntails: Credentails){
    val userId = login(credntails)
    val userData = loadUserData(userId)
    showData(userData)
}
```
suspend 변경자를 통해 함수가 실행을 잠시 멈출 수도 있다는 뜻이다. 대신 함수 실행이 일시 중단되면 다른 코드가 같은 스레드에서 실행될 수 있다

## 14.6 코루틴 빌더
코루틴은 일시 중단 가능한 계산의 인스턴스다. 이를 다른 코루틴들과 동시에 실행될 수 있는 코드 블록으로 생각할 수 있다. 
스레드와 비슷하지만 코루틴은 함수 실행을 일시 중단하는데 필요한 메커니즘을 포함하고 있다. 코루틴 빌더 함수는 아래와 같다.

- runBlocking: 블로킹 코드와 일시 중단 함수의 세계를 연결할 때 쓰인다.
- launch: 값을 반환하지 않는 새로운 코루틴을 시작할 때 쓰인다.
- async: 비동기적으로 값을 계산할 때 쓰인다.


## 14.7 디스패처
코루틴의 디스패처는 코루틴을 실행할 스레드를 결정한다. 디스패처를 선택함으로써 코루틴을 특정 스레드로 제한하거나 스레드 풀에 분산시킬 수 있으며, 코루틴이 한 스레드에서만 실행될지 여러 스레드에서 실행될지 결정할 수 있다.
부모 코루틴에의 디스패처에서 새로운 코루틴이 시작되며, 반드시 디스패처를 지정할 필요는 없다. 

